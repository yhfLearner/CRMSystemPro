<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:shiro="http://www.thymeleaf.org/thymeleaf-extras-shiro">

<head>
	<!-- 页面meta -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">




	<title>产品列表</title>





	<!-- Tell the browser to be responsive to screen width -->
	<meta
			content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
			name="viewport">
	<!-- Bootstrap 3.3.6 -->
	<!-- Font Awesome -->
	<!-- Ionicons -->
	<!-- iCheck -->
	<!-- Morris chart -->
	<!-- jvectormap -->
	<!-- Date Picker -->
	<!-- Daterange picker -->
	<!-- Bootstrap time Picker -->
	<!--<link rel="stylesheet" th:href="@{/@{/@{/plugins/timepicker/bootstrap-timepicker.min.css}">-->
	<!-- bootstrap wysihtml5 - text editor -->
	<!--数据表格-->
	<!-- 表格树 -->
	<!-- select2 -->
	<!-- Bootstrap Color Picker -->
	<!-- bootstrap wysihtml5 - text editor -->
	<!--bootstrap-markdown-->
	<!-- Theme style -->
	<!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
	<!-- Ion Slider -->
	<!-- ion slider Nice -->
	<!-- bootstrap slider -->
	<!-- bootstrap-datetimepicker -->

	<!-- HTML5 Shim and Respond.js} IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js} doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->








	<!-- jQuery 2.2.3 -->
	<!-- jQuery UI 1.11.4 -->
	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	<!-- Bootstrap 3.3.6 -->
	<!-- Morris.js} charts -->
	<!-- Sparkline -->
	<!-- jvectormap -->
	<!-- jQuery Knob Chart -->
	<!-- daterangepicker -->
	<!-- datepicker -->
	<!-- Bootstrap WYSIHTML5 -->
	<!-- Slimscroll -->
	<!-- FastClick -->
	<!-- iCheck -->
	<!-- AdminLTE App -->
	<!-- 表格树 -->
	<!-- select2 -->
	<!-- bootstrap color picker -->
	<!-- bootstrap time picker -->
	<!--<script th:src="@{/@{/@{/plugins/timepicker/bootstrap-timepicker.min.js}"></script>-->
	<!-- Bootstrap WYSIHTML5 -->
	<!--bootstrap-markdown-->
	<!-- CK Editor -->
	<!-- InputMask -->
	<!-- DataTables -->
	<!-- ChartJS 1.0.1 -->
	<!-- FLOT CHARTS -->
	<!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
	<!-- FLOT PIE PLUGIN - also used to draw donut charts -->
	<!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
	<!-- jQuery Knob -->
	<!-- Sparkline -->
	<!-- Morris.js} charts -->
	<!-- Ion Slider -->
	<!-- Bootstrap slider -->
	<!-- bootstrap-datetimepicker -->
	<!-- 页面meta /-->

	<link rel="stylesheet"
		  th:href="@{/plugins/bootstrap/css/bootstrap.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/font-awesome/css/font-awesome.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/ionicons/css/ionicons.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/iCheck/square/blue.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/morris/morris.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/jvectormap/jquery-jvectormap-1.2.2.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/datepicker/datepicker3.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/daterangepicker/daterangepicker.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/datatables/dataTables.bootstrap.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/treeTable/jquery.treetable.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/treeTable/jquery.treetable.theme.default.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/select2/select2.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/colorpicker/bootstrap-colorpicker.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/adminLTE/css/AdminLTE.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/adminLTE/css/skins/_all-skins.min.css}">
	<link rel="stylesheet"
		  th:href="@{/css/style.css}">
	<link rel="stylesheet"
		  th:href="@{/css/page.css}">
	<link rel="stylesheet"
		  th:href="@{/css/alertify.core.css}">
	<link rel="stylesheet"
		  th:href="@{/css/alertify.default.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/ionslider/ion.rangeSlider.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/ionslider/ion.rangeSlider.skinNice.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/bootstrap-slider/slider.css}">
	<link rel="stylesheet"
		  th:href="@{/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css}">
</head>

<body class="hold-transition skin-purple sidebar-mini">

<div class="wrapper">

	<!-- 页面头部 -->
	<div th:replace="~{pages/header::main-header}"></div>
	<!-- 页面头部 /-->
	<!-- 导航侧栏 -->
	<div th:replace="~{pages/aside::main-sidebar}"></div>
	<!-- 导航侧栏 /-->

	<!-- 内容区域 -->
	<!-- @@master = admin-layout.html-->
	<!-- @@block = content -->

	<div class="content-wrapper">

		<!-- 内容头部 -->
		<section class="content-header">
			<h1>
				数据管理
				<small>数据列表</small>
			</h1>
			<ol class="breadcrumb">
				<li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
				<li><a href="#">数据管理</a></li>
				<li class="active">数据列表</li>
			</ol>
		</section>
		<!-- 内容头部 /-->

		<!-- 正文区域 -->
		<section class="content">

			<!-- .box-body -->
			<div class="box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title">列表</h3>
				</div>

				<div class="box-body">

					<!-- 数据表格 -->
					<div class="table-box">

						<!--工具栏-->
						<div class="pull-left">
							<div class="form-group form-inline">
								<div class="btn-group">
									<button type="button" class="btn btn-default" title="新建"
											onclick="location.href='product-add.html'"><i
											class="fa fa-file-o"></i> 新建
									</button>
									<button type="button" class="btn btn-default" title="删除" id="btn_del"><i
											class="fa fa-trash-o"></i> 删除
									</button>
									<button type="button" class="btn btn-default" title="开启" id="btn_open"><i class="fa fa-check"></i>
										开启
									</button>
									<button type="button" class="btn btn-default" title="屏蔽" id="btn_close"><i class="fa fa-ban"></i>
										屏蔽
									</button>
									<button type="button" class="btn btn-default" title="刷新" onclick="window.location.reload()"><i
											class="fa fa-refresh"></i> 刷新
									</button>
								</div>
							</div>
						</div>
						<div class="box-tools pull-right">
							<div class="has-feedback">
								<input type="text" class="form-control input-sm" placeholder="搜索">
								<span class="glyphicon glyphicon-search form-control-feedback"></span>
							</div>
						</div>
						<!--工具栏/-->

						<!--数据列表-->
						<table id="dataList" class="table table-bordered table-striped table-hover dataTable">
							<thead>
							<tr>
								<th class="" style="padding-right:0px;">
									<input id="selall" type="checkbox" class="icheckbox_square-blue">
								</th>
								<th class="sorting_asc">ID</th>
								<th class="sorting_desc">编号</th>
								<th class="sorting_asc sorting_asc_disabled">产品名称</th>
								<th class="sorting_desc sorting_desc_disabled">出发城市</th>
								<th class="sorting">出发时间</th>
								<th class="text-center sorting">产品价格</th>
								<th class="text-center sorting">产品描述</th>
								<th class="text-center sorting">状态</th>
								<th class="text-center">操作</th>
							</tr>
							</thead>
							<tbody id="tbody">

							</tbody>
						</table>
					</div>
					<!-- 数据表格 /-->
				</div>
				<!-- /.box-body -->

				<!-- .box-footer-->
				<div class="box-footer">
					<div class="pull-left" style="float: left" >
						<div class="form-group form-inline">
							总共<span id="pageTotals">2</span> 页，共<span id="totalRecords">14</span> 条数据。 每页
							<select class="form-control" id="pageSize">
							</select> 条
						</div>
					</div>

					<!--<div class="box-tools pull-right">
                        <ul class="pagination">
                            <li>
                                <a href="#" aria-label="Previous">首页</a>
                            </li>
                            <li><a href="#">上一页</a></li>
                            <li><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                            <li><a href="#">4</a></li>
                            <li><a href="#">5</a></li>
                            <li><a href="#">下一页</a></li>
                            <li>
                                <a href="#" aria-label="Next">尾页</a>
                            </li>
                        </ul>-->
					<div id="Pagination" style="float: right"> </div>
				</div>


			</div>
			<!-- /.box-footer-->




		</section>
		<!-- 正文区域 /-->

	</div>
	<!-- @@close -->
	<!-- 内容区域 /-->

	<!-- 底部导航 -->
	<footer class="main-footer">
		<div class="pull-right hidden-xs">
			<b>Version</b> 1.0.8
		</div>
		<strong>Copyright &copy; 2014-2017 <a href="http://www.hwua.com">上海海文信息技术有限公司</a>.</strong> All rights reserved.
	</footer>
	<!-- 底部导航 /-->

</div>


<script
		th:src="@{/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<script
		th:src="@{/plugins/jQuery/jquery.pagination.js}"></script>
<script
		th:src="@{/plugins/jQueryUI/jquery-ui.min.js}"></script>
<script>
	$.widget.bridge('uibutton', $.ui.button);
</script>
<script
		th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<script
		th:src="@{/plugins/raphael/raphael-min.js}"></script>
<script
		th:src="@{/plugins/morris/morris.min.js}"></script>
<script
		th:src="@{/plugins/sparkline/jquery.sparkline.min.js}"></script>
<script
		th:src="@{/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js}"></script>
<script
		th:src="@{/plugins/jvectormap/jquery-jvectormap-world-mill-en.js}"></script>
<script
		th:src="@{/plugins/knob/jquery.knob.js}"></script>
<script
		th:src="@{/plugins/daterangepicker/moment.min.js}"></script>
<script
		th:src="@{/plugins/daterangepicker/daterangepicker.js}"></script>
<script
		th:src="@{/plugins/daterangepicker/daterangepicker.zh-CN.js}"></script>
<script
		th:src="@{/plugins/datepicker/bootstrap-datepicker.js}"></script>
<script
		th:src="@{/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js}"></script>
<script
		th:src="@{/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js}"></script>
<script
		th:src="@{/plugins/slimScroll/jquery.slimscroll.min.js}"></script>
<script
		th:src="@{/plugins/fastclick/fastclick.js}"></script>
<script
		th:src="@{/plugins/iCheck/icheck.min.js}"></script>
<script
		th:src="@{/plugins/adminLTE/js/app.min.js}"></script>
<script
		th:src="@{/plugins/treeTable/jquery.treetable.js}"></script>
<script
		th:src="@{/plugins/select2/select2.full.min.js}"></script>
<script
		th:src="@{/plugins/colorpicker/bootstrap-colorpicker.min.js}"></script>
<script
		th:src="@{/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.zh-CN.js}"></script>
<script
		th:src="@{/plugins/bootstrap-markdown/js/bootstrap-markdown.js}"></script>
<script
		th:src="@{/plugins/bootstrap-markdown/locale/bootstrap-markdown.zh.js}"></script>
<script
		th:src="@{/plugins/bootstrap-markdown/js/markdown.js}"></script>
<script
		th:src="@{/plugins/bootstrap-markdown/js/to-markdown.js}"></script>
<script
		th:src="@{/plugins/ckeditor/ckeditor.js}"></script>
<script
		th:src="@{/plugins/input-mask/jquery.inputmask.js}"></script>
<script
		th:src="@{/plugins/input-mask/jquery.inputmask.date.extensions.js}"></script>
<script
		th:src="@{/plugins/input-mask/jquery.inputmask.extensions.js}"></script>
<script
		th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
<script
		th:src="@{/plugins/datatables/dataTables.bootstrap.min.js}"></script>
<script
		th:src="@{/plugins/chartjs/Chart.min.js}"></script>
<script
		th:src="@{/plugins/flot/jquery.flot.min.js}"></script>
<script
		th:src="@{/plugins/flot/jquery.flot.resize.min.js}"></script>
<script
		th:src="@{/plugins/flot/jquery.flot.pie.min.js}"></script>
<script
		th:src="@{/plugins/flot/jquery.flot.categories.min.js}"></script>
<script
		th:src="@{/plugins/ionslider/ion.rangeSlider.min.js}"></script>
<script
		th:src="@{/plugins/bootstrap-slider/bootstrap-slider.js}"></script>
<script
		th:src="@{/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js}"></script>
<script
		th:src="@{/plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js}"></script>
<script th:src="@{/plugins/jQuery/alertify.js}"></script>
<script>
	var isFirst=true;
	var currPage;
	$(function () {
		//ctxPath = /*[[@{/}]]*/'';/*js获取项目thymeleaf的根路径*/
		pagination(1, 3);/*分页函数*/

		$("#pageSize").change(function () {
			/*先清空再添加，防止重复添加*/
			$("#tbody").empty();
			isFirst = true;//重新初始化
			pagination(1, $(this).val());
		})
	});

	//分页函数
	function pagination(pageNum, pageSize) {
		$.get( "/product/allInfo", {"pageNum": pageNum, "pageSize": pageSize}, function (data) {
			$("#tbody").empty();
			$.each(data.list, function (index, product) {
				var $tr = $("<tr></tr>");
				var $td1 = $("<td><input name='ids' type='checkbox' value='"+ product.id +"'></td>");
				var $td2 = $("<td id='proId'>" + product.id+ "</td>");
				var $td3 = $("<td>" + product.productNum + "</td>");
				var $td4 = $("<td>" + product.productName + "</td>");
				var $td5 = $("<td>" + product.cityName + "</td>");
				var $td6 = $("<td>" + product.departureTime + "</td>");
				var $td7 = $("<td>" + product.productPrice + "</td>");
				var status= product.productStatus == 1 ?"开启":"关闭";
				var $td8 = $("<td class='text-center'>" + product.productDesc + "</td>");
				var $td9 = $("<td class='text-center'>" + status + "</td>");
				var $td10 = $(" <td class='text-center'>" +
						" <button type='button' id='btn_pro' class='btn bg-olive btn-xs'  onclick='getId(\""+product.id+"\")'>订单</button>" +
						" </td>");
				$tr.append($td1).append($td2).append($td3).append($td4).append($td5).append($td6).append($td7).append($td8).append($td9).append($td10);
				$("#tbody").append($tr);
			});
			/*设置总页数和总记录数*/
			$("#pageTotals").html(data.pages);
			$("#totalRecords").html(data.total);


			/*创建下拉菜单*/
			$("#pageSize").empty();
			for(var i=1;i<=5;i++) {
				var $option;
				if(i==data.pageSize) {
					$option = $("<option selected='selected'>" + i + "</option>");
				}else{
					$option = $("<option>" + i + "</option>");
				}
				$("#pageSize").append($option);
			}

			/*假如是第一次加载,分页插件做初始化*/
			if(isFirst){
				initPagination(data.total,pageSize);//初始化分頁插件
				isFirst=false;
			}

		});
	}
	function getId(id){
		window.location.href = "/product/queryOrders/"+id;
	}
	/**
	 * 初始化分页插件
	 */
	function initPagination(total,pageSize) {
		/*初始化插件*/
		$("#Pagination").pagination(total, {
			num_edge_entries: 2, //边缘页数
			num_display_entries:4, //主体页数
			callback: pageselectCallback,
			items_per_page: pageSize, //每页显示个数
			prev_text: "前一页",
			next_text: "后一页"
		});

		/**
		 * 分页处理
		 */
		function pageselectCallback(page_index){
			currPage=page_index+1;
			//不是首次加载，也就是点击分页插件
			if(!isFirst){
				pagination(page_index + 1, pageSize);
			}
			isFirst=false;
			return false;
		}
	}

	$(function () {
		// 选择框
		$(".select2").select2();
		// WYSIHTML5编辑器
		$(".textarea").wysihtml5({
			locale: 'zh-CN'
		});
	});


	// 设置激活菜单
	function setSidebarActive(tagUri) {
		var liObj = $("#" + tagUri);
		if (liObj.length > 0) {
			liObj.parent().parent().addClass("active");
			liObj.addClass("active");
		}
	}


	$(function () {
		// 激活导航位置
		setSidebarActive("admin-datalist");

		// 列表按钮
		$("#dataList td input[type='checkbox']").iCheck({
			checkboxClass: 'icheckbox_square-blue',
			increaseArea: '20%'
		});
		// 全选操作
		$("#selall").click(function () {
			var clicks = $(this).is(':checked');
			if (!clicks) {
				$("#dataList td input[type='checkbox']").iCheck("uncheck");
			} else {
				$("#dataList td input[type='checkbox']").iCheck("check");
			}
			$(this).data("clicks", !clicks);
		});

		/**
		 * 更新状态开启
		 */
		$("#btn_open").click(function () {
			updateProductStatus(1)
		})


		/**
		 * 更新状态关闭
		 */
		$("#btn_close").click(function () {
			updateProductStatus(0)
		})
	});

	/**
	 * 删除产品
	 */
	$("#btn_del").click(function () {
		deleteProduct();
	});

	function reset () {
		alertify.set({
			labels : {
				ok     : "确定",
				cancel : "取消"
			},
			delay : 5000,
			buttonReverse : false,
			buttonFocus   : "ok"
		});
	}


	//更新商品状态
	//更新商品状态
	function updateProductStatus(status) {
		reset();
		var ids = [];
		$("input[name='ids']:checked").each(function (index) {
			ids[index]=$(this).val();
		})
		if(ids.length==0){
			alertify.alert("请选择要操作的选项！");
			return false;
		}else{
			alertify.confirm("是否确定更新?",
					function(e) {
						if (e) {
							$.ajax({
								url: "/product/updateStatus",
								type: "post",
								traditional: true,
								dataType: "json",
								data: {
									"_method": "put",
									"ids": ids,
									"productStatus": status
								},
								success: function () {
									pagination(currPage, $("#pageSize").val());
								}
							})
							alertify.success("更新成功")
						}else {
							alertify.error("取消")
						}
					});
					/*function(){
						alertify.error('取消');
					});*/
		}
	}

	function deleteProduct() {
		reset();
		var ids = [];
		$("input[name='ids']:checked").each(function (index) {
			ids[index]=$(this).val();
		})
		if(ids.length==0){
			alertify.alert("请选择要操作的选项！");
			return false;
		}else{
			alertify.confirm("是否确定删除?",
					function(){
						$.ajax({
							url : "/product/deleteProduct",
							type:"post",
							traditional: true,
							dataType : "json",
							data : {
								"_method":"delete",
								"ids" : ids
							},
							success: function () {
								pagination(currPage,$("#pageSize").val());
							}
						})
					},
					function(){
						alertify.error('取消');
					});
		}
	}
</script>
<script>
		$(function () {
			$("body").on("click", "#search", function () {
				var $term = $("#term").val();
				if ($term == "") { alert("请输入信息"); return false; }
				window.location.href="/showProduct/"+$term+"/"+10;
			});
		});
		$('#term').bind('keypress', function (event) {
			if (event.keyCode == "13") {
				$("#search").click();
			}
		})
	/*	$(function () {
			$(document).keyup(function(event){
				if (event.keyCode == "13") {
					$("#search").click(function () {
						var $term = $("#term").val();
						alert($("#term").val());
						if ($term == "") { alert("请输入信息"); return false; }
						window.location.href="/showProduct/"+$term+"/"+10;
					});
				}
			})

		});*/
</script>
<!--	<div class="has-feedback">
		<input type="text" class="form-control input-sm"
			   placeholder="输入内容" id="term"><input type="button"  id="search" value="搜索"> <span
			class="glyphicon glyphicon-search form-control-feedback"></span>
	</div>-->
</body>

</html>